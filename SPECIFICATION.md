# GAB Study アプリ仕様書

## 概要

GABテスト（図表読み取り）の学習アプリ。スキマ学習と通常学習を統合し、
オフラインでも完結する学習体験を提供する。

## 技術スタック

- **フレームワーク**: React Native (Expo) + TypeScript
- **ルーティング**: Expo Router (ファイルベース)
- **データベース**: expo-sqlite (ローカル永続化)
- **ジェスチャー**: react-native-gesture-handler + react-native-reanimated
- **アイコン**: @expo/vector-icons (Ionicons)

## アーキテクチャ

```
GABStudy/
├── app/                        # Expo Router 画面定義
│   ├── _layout.tsx             # ルートレイアウト (Stack)
│   ├── (tabs)/                 # タブナビゲーション
│   │   ├── _layout.tsx         # タブレイアウト (4タブ)
│   │   ├── index.tsx           # ホーム画面
│   │   ├── learn.tsx           # 学習画面
│   │   ├── test.tsx            # テスト画面
│   │   └── data.tsx            # データ分析画面
│   ├── question/[id].tsx       # 1問画面 (学習モード)
│   ├── test-session/index.tsx  # テストセッション画面
│   ├── test-result/[id].tsx    # テスト結果画面
│   └── settings.tsx            # 設定画面
├── src/
│   ├── types/index.ts          # 型定義
│   ├── constants/
│   │   ├── theme.ts            # テーマ定数 (色/余白/フォント)
│   │   └── categories.ts      # カテゴリ定義/間隔反復定数
│   ├── db/
│   │   ├── database.ts         # SQLiteデータベース操作
│   │   └── sampleProblems.ts   # サンプル問題データ
│   ├── logic/
│   │   ├── sessionPicker.ts    # 出題ロジック (スキマ学習)
│   │   └── reviewScheduler.ts  # 間隔反復スケジューラ
│   ├── hooks/
│   │   ├── useTimer.ts         # カウントアップタイマー
│   │   └── useCountdownTimer.ts # カウントダウンタイマー
│   └── components/
│       ├── ProgressRing.tsx     # タイマーUI (極小チップ)
│       ├── CalcMemo.tsx         # 計算メモ (半画面スライド)
│       └── TagSelector.tsx      # タグ選択モーダル
└── assets/                     # アイコン/スプラッシュ画像
```

## データモデル (SQLite)

### テーブル一覧

| テーブル | 用途 |
|---|---|
| `attempts` | 解答ログ (problemId, 正誤, 時間, 選択肢) |
| `review_queue` | 復習キュー (problemId, 次回日, ステージ) |
| `problem_notes` | ブックマーク・タグ・メモ |
| `session_state` | 中断セッション保存 (再開用) |
| `test_results` | テスト結果 (スコア, カテゴリ別) |
| `settings` | アプリ設定 (key-value) |

### Attempt (解答ログ)
```
id TEXT PRIMARY KEY
problemId TEXT
answeredAt TEXT (ISO日時)
isCorrect INTEGER (0/1)
selectedIndex INTEGER
timeMs INTEGER
calcHistory TEXT (JSON: 計算メモ履歴)
```

### ReviewQueue (復習キュー)
```
problemId TEXT PRIMARY KEY
nextReviewAt TEXT (ISO日時)
stage INTEGER (0=即日, 1=3日, 2=7日, 3=14日, 4=30日)
```

## 画面仕様

### 1. ホーム画面 (app/(tabs)/index.tsx)
- クイックスタート (60秒/3分/5分ワンタップ)
- 復習だけ / スピード強化ボタン
- 途中再開カード
- 今日のおすすめ (自動提案)
- 進捗サマリ (今日/7日)
- カテゴリカード (表/棒/円/複合)
- 管理リンク (問題一覧/ブックマーク/苦手)
- 模試プリセット

### 2. 学習画面 (app/(tabs)/learn.tsx)
- カテゴリタブ (進捗率表示)
- フィルタ (未学習/間違い/正解/ブックマーク/苦手)
- 問題一覧 (ステータスアイコン付き)

### 3. 1問画面 (app/question/[id].tsx) ★差別化ポイント
- 図表エリア (ピンチズーム/ドラッグ)
- タイマー (極小チップ、目標時間リング)
- 選択肢 → 確定ボタン → 解説表示
- 計算メモ (半画面スライドアップ)
  - 式入力→結果、履歴積み上げ
  - ショートカット (×10, ÷10, ×100, ÷100, %)
  - 単位変換 (百万円↔億円)
  - 問題ごとに保存
- タグ (単位/割合/見落とし/概算/時間不足/読み違い)
- 解説 (ステップ式 + よくあるミス)

### 4. テスト画面 (app/(tabs)/test.tsx)
- プリセット模試 (本番20問/16分, ハーフ, ミニ)
- 弱点テスト (自動構成)
- カスタムテスト (問数/時間/カテゴリ指定)
- テスト履歴一覧

### 5. テストセッション (app/test-session/index.tsx)
- カウントダウンタイマー
- 問題番号ナビゲーション
- 旗(見直し)マーク
- タップ即確定モード

### 6. テスト結果 (app/test-result/[id].tsx)
- スコア + グレード (S/A/B/C/D)
- カテゴリ別成績
- 個別回答詳細
- 間違い/遅い問題を復習キューへ自動登録

### 7. データ画面 (app/(tabs)/data.tsx)
- 期間切替 (7日/30日)
- サマリ (学習時間/解答数/正答率/平均時間)
- 日別解答数チャート
- カテゴリ別成績 (進捗バー)
- 遅い問題ランキング

### 8. 設定画面 (app/settings.tsx)
- タイマー設定 (表示/数字/位置/目標時間)
- 学習モード (集中/練習)
- 再開時タイマー動作 (継続/リセット)
- オフライン設定
- データリセット
- 情報 (規約/プライバシー/お問い合わせ)

## 出題ロジック

### クイック学習選出 (優先順)
1. 復習期限が来た問題 (間隔反復)
2. 正解だが遅い問題 (スピード強化)
3. 直近で間違えた問題
4. 未学習の易しめの問題

### 間隔反復 (Spaced Repetition)
- 正解: stage + 1 → 間隔延長
- 不正解: stage - 1 (最低0) → 間隔短縮
- 間隔: [1日, 3日, 7日, 14日, 30日]

### カテゴリ別目標時間
- 表: 55秒
- 棒グラフ: 45秒
- 円グラフ: 40秒
- 複合: 55秒

## 学習カテゴリ
1. 表の読み取り (table)
2. 棒グラフ (bar)
3. 円グラフ (pie)
4. 複合グラフ (composite)

---

## 今後のタスク

### MVP残作業 (Phase 1)
- [ ] 実際の図表画像の追加 (各問題にグラフ/表画像を紐付け)
- [ ] オフライン対応の完全実装 (問題データの事前DL)
- [ ] エラーハンドリングの強化
- [ ] ユーザーテスト・UI微調整
- [ ] App Store / Google Play 提出準備

### 拡張機能 (Phase 2)
- [ ] 苦手原因の自動集計 → おすすめ精度UP
- [ ] 式テンプレート (増減率、構成比など)
- [ ] 問題パック追加 (課金要素対応)
- [ ] 集中/練習モード切替の高度化
- [ ] プッシュ通知 (復習リマインダー)
- [ ] ダークモード対応
- [ ] 問題データの外部JSONロード
- [ ] 成績のエクスポート機能
- [ ] ソーシャル機能 (ランキング等)

### 技術的改善
- [ ] 問題データのリモート管理 (API化)
- [ ] テストのモック化・自動テスト追加
- [ ] パフォーマンス最適化 (大量問題時)
- [ ] アクセシビリティ対応
- [ ] i18n対応 (多言語化)
